<h1 class="mb-4">Редактирование информации о региональном отделении</h1>
<form id="event-create-form" data-request-flash data-request="onEditRegion" method="POST"
    class="d-flex gap-3 flex-column" enctype="multipart/form-data">
    <h4>Основная информация</h4>
    <input type="hidden" name="region_id" value="{{ region.id ?? '' }}">
    <input class="form-control" type="text" placeholder="Название региона" readonly name="name"
        value="{{ region.name ?? '' }}" disabled>
    <input class="form-control" type="text" placeholder="Код региона" value="{{ region.code }}" readonly disabled
        name="code">
    <input hidden class="form-control" type="text" placeholder="Округ" value="{{ region.district.id }}" readonly
        disabled name="district_id">
    <input class="form-control" type="text" placeholder="Округ" value="{{ region.district.name }}" readonly disabled>
    <textarea class="form-control" placeholder="Описание регионального отделения" required
        name="description">{{ region.description ?? '' }}</textarea>

    <!-- Секция для добавления контактов -->
    <div class="contacts-section">
        <h4>Контакты</h4>
        <div id="contacts-list">
            {% for contact in region.contacts %}
            <div class="contact-item mb-2 d-flex gap-2">
                <input type="text" class="form-control" placeholder="Название контакта"
                    name="contacts[{{ loop.index0 }}][title]" value="{{ contact.title }}" required>
                <input type="text" class="form-control" placeholder="Контакт" name="contacts[{{ loop.index0 }}][value]"
                    value="{{ contact.value }}" required>
                <button type="button" class="btn btn-danger remove-contact">Удалить</button>
            </div>
            {% endfor %}
        </div>
        <button type="button" class="btn btn-secondary" id="add-contact">Добавить контакт</button>
    </div>

    <button class="btn btn-primary mt-3" data-attach-loading>Сохранить</button>
</form>

<script>
    document.getElementById('add-contact').addEventListener('click', function () {
        const contactList = document.getElementById('contacts-list');
        const contactCount = contactList.children.length;

        const contactItem = document.createElement('div');
        contactItem.classList.add('contact-item', 'mb-2', 'd-flex', 'gap-2');

        contactItem.innerHTML = `
            <input type="text" class="form-control" placeholder="Название контакта"
                name="contacts[${contactCount}][title]" required>
            <input type="text" class="form-control" placeholder="Контакт"
                name="contacts[${contactCount}][value]" required>
            <button type="button" class="btn btn-danger remove-contact">Удалить</button>
        `;

        contactList.appendChild(contactItem);

        // Удаление контакта
        contactItem.querySelector('.remove-contact').addEventListener('click', function () {
            contactItem.remove();
        });
    });

    // Добавляем обработку удаления для существующих контактов
    document.querySelectorAll('.remove-contact').forEach(function (button) {
        button.addEventListener('click', function () {
            this.closest('.contact-item').remove();
        });
    });
</script>